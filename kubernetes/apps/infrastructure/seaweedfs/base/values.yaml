# global:

master:
  enabled: true
  port: 9333
  grpcPort: 19333
  metricsPort: 9327
  ipBind: "0.0.0.0"
  volumePreallocate: false
  volumeSizeLimitMB: 2000
  # Upstream uses 001 (Rack awareness), chart default 000. Matching upstream.
  defaultReplication: "000"
  disableHttp: false
  resumeState: false
  electionTimeout: "10s"
  heartbeatInterval: "300ms"

  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 200m
      memory: 256Mi
  terminationGracePeriodSeconds: 60

  ingress:
    enabled: true
    className: null
    host: "master.seaweedfs.local"
    path: "/sw-master/?(.*)"
    pathType: ImplementationSpecific
    annotations: {}
    tls: []
  data:
    type: "persistentVolumeClaim"

  logs:
    type: "persistentVolumeClaim"

  affinity: |
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 100
          podAffinityTerm:
            labelSelector:
              matchLabels:
                app.kubernetes.io/component: master
                app.kubernetes.io/instance: {{ .Release.Name }}
                app.kubernetes.io/name: {{ template "seaweedfs.name" . }}
            topologyKey: kubernetes.io/hostname

volume:
  enabled: true
  port: 8080
  grpcPort: 18080
  metricsPort: 9327
  ipBind: "0.0.0.0"
  minFreeSpacePercent: 1
  terminationGracePeriodSeconds: 60

  resources:
    requests:
      cpu: 500m
      memory: 1Gi
    limits:
      cpu: 2000m
      memory: 4Gi

  # PublicURL is critical. Using string interpolation format that shell will evaluate.
  extraArgs:
    - "-publicUrl=${POD_NAME}.${SEAWEEDFS_FULLNAME}-volume.seaweedfs.ruth.example.com:80"
    - "-max=15"

  dataDirs:
    - name: data
      type: "persistentVolumeClaim"

  data:
    type: "persistentVolumeClaim"

  idx:
    type: "persistentVolumeClaim"

  logs:
    type: "persistentVolumeClaim"

  initContainers: |
    - name: seaweedfs-vol-fix-idx
      image: "{{ .Values.global.imageName }}:{{ .Values.image.tag | default .Chart.AppVersion }}"
      imagePullPolicy: IfNotPresent
      command: ["/bin/sh", "-c"]
      args: ["weed fix /data; if ls /data/*.idx  >/dev/null 2>&1; then mv /data/*.idx /idx/ ; fi; "]
      volumeMounts:
        - mountPath: /idx
          name: idx
        - mountPath: /data
          name: data

  affinity: |
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 100
          podAffinityTerm:
            labelSelector:
              matchLabels:
                app.kubernetes.io/component: volume
                app.kubernetes.io/instance: {{ .Release.Name }}
                app.kubernetes.io/name: {{ template "seaweedfs.name" . }}
            topologyKey: kubernetes.io/hostname

filer:
  enabled: true
  port: 8888
  grpcPort: 18888
  metricsPort: 9327
  ipBind: "0.0.0.0"
  defaultReplicaPlacement: "000"
  disableDirListing: false
  dirListLimit: 100000
  disableHttp: false
  redirectOnRead: false
  terminationGracePeriodSeconds: 60

  resources:
    requests:
      cpu: 200m
      memory: 512Mi
    limits:
      cpu: 1000m
      memory: 1Gi

  ingress:
    enabled: true
    className: null
    host: "seaweedfs.cluster.local"
    path: "/"
    pathType: Prefix
    annotations: {}
    tls: []
  data:
    type: "persistentVolumeClaim"

  logs:
    type: "persistentVolumeClaim"

  affinity: |
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 100
          podAffinityTerm:
            labelSelector:
              matchLabels:
                app.kubernetes.io/component: filer
                app.kubernetes.io/instance: {{ .Release.Name }}
                app.kubernetes.io/name: {{ template "seaweedfs.name" . }}
            topologyKey: kubernetes.io/hostname

s3:
  enabled: true
  port: 8333
  metricsPort: 9327
  enableAuth: true
  bindAddress: "0.0.0.0"
  domainName: ""
  terminationGracePeriodSeconds: 60
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 500m
      memory: 512Mi

  ingress:
    enabled: true
    className: null
    host: "s3.seaweedfs.local"
    path: "/"
    pathType: Prefix
    annotations: {}
    tls: []
  logs:
    type: "hostPath"
    hostPathPrefix: /storage # Placeholder, upstream s3 deployment doesn't show logs volumeMounts explicitly in the snippet I saw?
    # Re-checking upstream: s3 deployment (lines 312+) has no volumeMounts.
    # So we should probably set this to emptyDir or disable if possible to match.
    # Chart defaults logs to hostPath/emptyDir.
    # Let's use emptyDir for now.
    # type: "emptyDir"

worker:
  enabled: true
  metricsPort: 9327
  capabilities: "vacuum,balance,erasure_coding"
  maxConcurrent: 3
  workingDir: "/tmp/seaweedfs-worker"
  terminationGracePeriodSeconds: 60

  resources:
    requests:
      cpu: "500m"
      memory: "512Mi"
    limits:
      cpu: "2"
      memory: "2Gi"

  affinity: |
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 100
          podAffinityTerm:
            labelSelector:
              matchLabels:
                app.kubernetes.io/component: worker
                app.kubernetes.io/instance: {{ .Release.Name }}
                app.kubernetes.io/name: {{ template "seaweedfs.name" . }}
            topologyKey: kubernetes.io/hostname

admin:
  enabled: true
  port: 23646
  grpcPort: 33646
  terminationGracePeriodSeconds: 60

  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 200m
      memory: 128Mi

  secret:
    existingSecret: seaweedfs-admin-secret
    userKey: adminUser
    pwKey: adminPassword

  data:
    type: "persistentVolumeClaim"

  logs:
    type: "persistentVolumeClaim"

  ingress:
    enabled: true
    className: null
    host: "admin.seaweedfs.local"
    path: "/"
    pathType: Prefix
    annotations: {}
    tls: []

  affinity: |
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 100
          podAffinityTerm:
            labelSelector:
              matchLabels:
                app.kubernetes.io/component: admin
                app.kubernetes.io/instance: {{ .Release.Name }}
                app.kubernetes.io/name: {{ template "seaweedfs.name" . }}
            topologyKey: kubernetes.io/hostname

# Missing: WebDAV (not in chart) add in future
