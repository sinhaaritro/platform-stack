# Populated values.yaml matching current upstream.yaml configuration
master:
  enabled: true
  replicas: 1
  port: 9333
  grpcPort: 19333
  metricsPort: 9327
  ipBind: "0.0.0.0"
  volumePreallocate: false
  volumeSizeLimitMB: 1000
  # Upstream uses 001 (Rack awareness), chart default 000. Matching upstream.
  defaultReplication: "000"
  disableHttp: false
  resumeState: false
  electionTimeout: "10s"
  heartbeatInterval: "300ms"

  # Matching upstream resource requests
  resources:
    requests: {}
  ingress:
    enabled: true
    className: null
    # host: false for "*" hostname, or an array for multiple hostnames
    host: "master.seaweedfs.local"
    path: "/sw-master/?(.*)"
    pathType: ImplementationSpecific
    annotations: {}
    tls: []
  # Upstream storage: 1Gi Longhorn for data, 1Gi Longhorn0rep for logs
  data:
    type: "persistentVolumeClaim"
    size: "1Gi"
    storageClass: "longhorn"

  logs:
    type: "persistentVolumeClaim"
    size: "1Gi"
    storageClass: "longhorn0rep"

  # Upstream has preferred AntiAffinity
  affinity: |
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 100
          podAffinityTerm:
            labelSelector:
              matchLabels:
                app.kubernetes.io/component: master
                app.kubernetes.io/instance: {{ .Release.Name }}
                app.kubernetes.io/name: {{ template "seaweedfs.name" . }}
            topologyKey: kubernetes.io/hostname

volume:
  enabled: true
  port: 8080
  grpcPort: 18080
  metricsPort: 9327
  ipBind: "0.0.0.0"
  replicas: 1
  minFreeSpacePercent: 1

  # Matching upstream arguments
  # PublicURL is critical. Using string interpolation format that shell will evaluate.
  extraArgs:
    - "-publicUrl=${POD_NAME}.${SEAWEEDFS_FULLNAME}-volume.seaweedfs.ruth.example.com:80"

  # Upstream HostPath for data
  dataDirs:
    - name: data1
      type: "hostPath"
      hostPathPrefix: "/ssd/object_store"
      maxVolumes: 0

  # Upstream IDX and Logs on Longhorn
  idx:
    type: "persistentVolumeClaim"
    size: "1Gi"
    storageClass: "longhorn"

  logs:
    type: "persistentVolumeClaim"
    size: "1Gi"
    storageClass: "longhorn0rep"

  # Upstream Init Container for fixing/moving indexes
  initContainers: |
    - name: seaweedfs-vol-fix-idx
      image: chrislusf/seaweedfs:4.07
      imagePullPolicy: IfNotPresent
      command: ["/bin/sh", "-c"]
      args: ["weed fix /data1; if ls /data1/*.idx  >/dev/null 2>&1; then mv /data1/*.idx /idx/ ; fi; "]
      volumeMounts:
        - mountPath: /idx
          name: idx
        - mountPath: /data1
          name: data1

  affinity: |
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 100
          podAffinityTerm:
            labelSelector:
              matchLabels:
                app.kubernetes.io/component: volume
                app.kubernetes.io/instance: {{ .Release.Name }}
                app.kubernetes.io/name: {{ template "seaweedfs.name" . }}
            topologyKey: kubernetes.io/hostname

filer:
  enabled: true
  replicas: 1
  port: 8888
  grpcPort: 18888
  metricsPort: 9327
  ipBind: "0.0.0.0"
  defaultReplicaPlacement: "000"
  disableDirListing: false
  dirListLimit: 100000
  disableHttp: false
  redirectOnRead: false

  # Enable S3 on Filer as per upstream
  extraArgs:
    - "-s3"
    - "-s3.port=8333"
  ingress:
    enabled: true
    className: null
    # host: false for "*" hostname
    host: "seaweedfs.cluster.local"
    path: "/"
    pathType: Prefix
    annotations: {}
    tls: []
  # Upstream storage: 5Gi Longhorn for data, 1Gi Longhorn0rep for logs
  data:
    type: "persistentVolumeClaim"
    size: "5Gi"
    storageClass: "longhorn"

  logs:
    type: "persistentVolumeClaim"
    size: "1Gi"
    storageClass: "longhorn0rep"

  affinity: |
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 100
          podAffinityTerm:
            labelSelector:
              matchLabels:
                app.kubernetes.io/component: filer
                app.kubernetes.io/instance: {{ .Release.Name }}
                app.kubernetes.io/name: {{ template "seaweedfs.name" . }}
            topologyKey: kubernetes.io/hostname

s3:
  enabled: true
  replicas: 1
  port: 8333
  metricsPort: 9327
  enableAuth: false
  bindAddress: "0.0.0.0"
  domainName: ""
  ingress:
    enabled: true
    className: null
    # host: false for "*" hostname, or an array for multiple hostnames
    host: "s3.seaweedfs.local"
    path: "/"
    pathType: Prefix
    # additional ingress annotations for the s3 endpoint
    annotations: {}
    tls: []
  # Upstream S3 has no specific storage, just EmptyDir/None usually, or logs.
  logs:
    type: "hostPath"
    hostPathPrefix: /storage # Placeholder, upstream s3 deployment doesn't show logs volumeMounts explicitly in the snippet I saw?
    # Re-checking upstream: s3 deployment (lines 312+) has no volumeMounts.
    # So we should probably set this to emptyDir or disable if possible to match.
    # Chart defaults logs to hostPath/emptyDir.
    # Let's use emptyDir for now.
    # type: "emptyDir"

worker:
  enabled: true
  replicas: 1
  metricsPort: 9327
  capabilities: "vacuum,balance,erasure_coding"
  maxConcurrent: 3
  workingDir: "/tmp/seaweedfs-worker"

  # Upstream resources
  resources:
    requests:
      cpu: "500m"
      memory: "512Mi"
    limits:
      cpu: "2"
      memory: "2Gi"

  affinity: |
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 100
          podAffinityTerm:
            labelSelector:
              matchLabels:
                app.kubernetes.io/component: worker
                app.kubernetes.io/instance: {{ .Release.Name }}
                app.kubernetes.io/name: {{ template "seaweedfs.name" . }}
            topologyKey: kubernetes.io/hostname

# Attempting to enable Admin via chart values
admin:
  enabled: true
  replicas: 1
  port: 23646
  grpcPort: 33646

  adminUser: "admin"
  adminPassword: "admin" # Upstream secret decodes to 'admin'

  data:
    type: "persistentVolumeClaim"
    size: "5Gi"
    storageClass: "longhorn"

  logs:
    type: "persistentVolumeClaim"
    size: "5Gi" # Upstream says 5Gi for logs too
    storageClass: "longhorn0rep"

  ingress:
    enabled: true
    className: null
    host: "admin.seaweedfs.local"
    path: "/"
    pathType: Prefix
    annotations: {}
    tls: []

  affinity: |
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 100
          podAffinityTerm:
            labelSelector:
              matchLabels:
                app.kubernetes.io/component: admin
                app.kubernetes.io/instance: {{ .Release.Name }}
                app.kubernetes.io/name: {{ template "seaweedfs.name" . }}
            topologyKey: kubernetes.io/hostname

# Missing: WebDAV (not in chart), Ingresses (will need to patch or add manually)
