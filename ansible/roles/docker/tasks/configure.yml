# tasks/configure.yml
---
- name: Ensure Docker configuration directory exists
  ansible.builtin.file:
    path: /etc/docker
    state: directory
    mode: "0755"
  tags: [docker, config]

- name: Configure Docker Daemon (Log Rotation)
  ansible.builtin.copy:
    content: "{{ docker_daemon_config | to_nice_json }}"
    dest: /etc/docker/daemon.json
    mode: "0644"
  notify: Restart docker
  tags: [docker, config]

- name: Add users to docker group
  ansible.builtin.user:
    name: "{{ item }}"
    groups: docker
    append: true
  loop: "{{ docker_users }}"
  when:
    - item is defined
    - item != 'root' # Root is implicit, no need to add
  tags: [docker, users]

- name: Ensure Docker service is enabled and running
  ansible.builtin.service:
    name: docker
    state: started
    enabled: true
  tags: [docker, service]
