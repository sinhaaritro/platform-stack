
# Proxmox LXC VPN Gateway with Gluetun

This guide provides a complete walkthrough for setting up a dedicated VPN gateway in a Proxmox LXC container using Docker and Gluetun. The container will connect to ProtonVPN (using OpenVPN) and expose a SOCKS5 proxy that other services on your network (like a qBittorrent pod) can use to route their traffic through the VPN.

## Prerequisites

1.  A running Proxmox VE instance.
2.  A Proxmox LXC template (e.g., Debian 12 "Bookworm").
3.  A ProtonVPN account.

## Final Configuration Details

-   **LXC ID:** `2006`
-   **LXC Name:** `bananagator-03`
-   **LXC IP Address:** `192.168.0.28`
-   **SOCKS5 Proxy:** `192.168.0.28:1080`

---

## Step 1: Create the LXC Container

1.  In the Proxmox web UI, click **"Create CT"**.
2.  **General:**
    -   **CT ID:** `2006`
    -   **Hostname:** `bananagator-03`
    -   Set a secure **Password**.
3.  **Template:**
    -   Select a **Debian 12** or recent Ubuntu template.
4.  **Disks:**
    -   Set **Disk size** to `8` GB (or more).
5.  **CPU:**
    -   Assign `1` or `2` **Cores**.
6.  **Memory:**
    -   Set **Memory** to `1024` MB (2048 MB is recommended).
7.  **Network:**
    -   **IPv4:** `Static`
    -   **IPv4/CIDR:** `192.168.0.28/24`
    -   **Gateway (IPv4):** Your router's IP address (e.g., `192.168.0.1`).
8.  **DNS:**
    -   Leave **DNS domain** blank.
    -   Set **DNS servers** to your router or a public one like `1.1.1.1`.
9.  Confirm and finish the creation process. **Do not start the container yet.**

---

## Step 2: Manually Enable Nesting and TUN/TAP

These features are required to run Docker and a VPN inside the LXC.

1.  In the Proxmox UI, select the **Proxmox Node** (not the container) and open the **Shell**.
2.  Edit the configuration file for the new container using its ID:
    ```bash
    nano /etc/pve/lxc/2006.conf
    ```
3.  Add the following lines to the bottom of the file to enable Docker nesting and grant access to the TUN device:
    ```conf
    # Enable Nesting for Docker
    features: nesting=1

    # Grant access to the TUN device for VPN
    lxc.cgroup2.devices.allow: c 10:200 rwm
    lxc.mount.entry: /dev/net/tun dev/net/tun none bind,create=file
    ```
   4.  Save and close the file (`Ctrl+X`, then `Y`, then `Enter`).

---

## Step 3: Start the LXC and Install Docker

1.  Start the container `2006 (bananagator-03)` from the Proxmox UI.
2.  Open the container's **Console**.
3.  Log in as `root` with the password you set.
4.  Update the system:
    ```bash
    apt update && apt upgrade -y
    ```
5.  Install Docker using the official script:
    ```bash
    curl -fsSL https://get.docker.com -o get-docker.sh
    sh get-docker.sh
    ```
6.  Install the Docker Compose plugin:
    ```bash
    apt install -y docker-compose-plugin
    ```
7.  Verify the installation:
    ```bash
    docker --version
    docker compose version
    ```

---

## Step 4: Configure Gluetun

### 4.1 Get ProtonVPN OpenVPN Credentials

You must use special credentials generated by ProtonVPN, **not** your regular login.

1.  Log in to your account at [protonvpn.com](https://protonvpn.com).
2.  Navigate to **Account > OpenVPN / IKEv2 username**.
3.  Copy the **Username** and **Password** shown there.

### 4.2 Create the Docker Compose File

1.  In the LXC console, create a directory for your configuration:
    ```bash
    mkdir -p /opt/gluetun
    cd /opt/gluetun
    ```
2.  Create the configuration file:
    ```bash
    nano docker-compose.yml
    ```
3.  Copy and paste the entire configuration below into the editor. **You must replace the placeholder credentials.**

    ```yaml
    # Note: The 'version' attribute is obsolete with modern Docker Compose.
    services:
      gluetun:
        image: qmcgaw/gluetun
        container_name: gluetun
        # Required to create the network tunnel interface
        cap_add:
          - NET_ADMIN
        # Mount the TUN device from the LXC host
        devices:
          - /dev/net/tun:/dev/net/tun
        volumes:
          # Persists gluetun's generated files
          - ./gluetun:/gluetun
        environment:
          # --- VPN Provider Settings ---
          - VPN_SERVICE_PROVIDER=protonvpn
          - VPN_TYPE=openvpn
          
          # --- ProtonVPN Credentials (REQUIRED) ---
          # Replace with the credentials from your ProtonVPN account page
          - OPENVPN_USER=YOUR_OPENVPN_USERNAME
          - OPENVPN_PASSWORD=YOUR_OPENVPN_PASSWORD

          # --- Server Selection ---
          # Comma-separated list of countries to connect to.
          - SERVER_COUNTRIES=India,Netherlands,Switzerland

          # --- Built-in SOCKS5 Proxy ---
          # This is the gateway for your other apps (like qBittorrent)
          - PROXY_SOCKS_LISTENING_ADDRESS=:1080
          
          # --- Timezone ---
          - TZ=Asia/Kolkata
        ports:
          # Map the SOCKS5 port to the LXC's IP address
          # Format: <HOST_PORT>:<CONTAINER_PORT>/<PROTOCOL>
          - "1080:1080/tcp"
        restart: unless-stopped
    ```
4.  **Replace** `YOUR_OPENVPN_USERNAME` and `YOUR_OPENVPN_PASSWORD` with the credentials you obtained.
5.  Save and close the file (`Ctrl+X`, then `Y`, then `Enter`).

---

## Step 5: Launch and Verify Gluetun

1.  From the `/opt/gluetun` directory, start the container in detached mode:
    ```bash
    docker compose up -d
    ```
2.  Check the logs to monitor the connection process:
    ```bash
    docker compose logs -f
    ```
    Wait until you see a green log message similar to this, which confirms success:
    `INFO[...][ip getter] Public IP address is ...`

3.  (Optional) Perform a manual check. The container image does not have `curl`, so use `wget`:
    ```bash
    docker exec gluetun wget -qO- ifconfig.io
    ```
    This command should print the public IP address of the VPN server, **not** your home IP.

## You are Done!

Your Gluetun VPN gateway is now running. Any application that you configure to use a SOCKS5 proxy at `192.168.0.28:1080` will have its traffic routed securely through the VPN.